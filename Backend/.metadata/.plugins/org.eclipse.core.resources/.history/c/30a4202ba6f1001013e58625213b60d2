package com.prueba.tecnica.service;

import java.util.List;

import org.springframework.stereotype.Service;

import com.prueba.tecnica.exception.ResourceNotFoundException;
import com.prueba.tecnica.model.dto.ClienteDto;
import com.prueba.tecnica.model.dto.CuentaDto;
import com.prueba.tecnica.model.entity.Cliente;
import com.prueba.tecnica.model.entity.Cuenta;
import com.prueba.tecnica.repository.ClienteRepository;
import com.prueba.tecnica.repository.CuentaRepository;

import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
public class CuentaService {
	private final CuentaRepository cuentaRepository;
	
	public CuentaDto crearCliente(CuentaDto request) {

        if (cuentaRepository.existsByNumerocuenta(request.getNumerocuenta())){
            throw new IllegalArgumentException("Identificaci√≥n ya registrada");
        }

        Cliente cliente = new Cliente();
        cliente.setNombre(request.getNombre());
        cliente.setGenero(request.getGenero());
        cliente.setEdad(request.getEdad());
        cliente.setIdentificacion(request.getIdentificacion());
        cliente.setDireccion(request.getDireccion());
        cliente.setTelefono(request.getTelefono());
        cliente.setContrasena(request.getPassword());
        cliente.setEstado(request.getEstado());

        Cliente guardado = clienteRepository.save(cliente);
        return mapearRespuesta(guardado);
    }
	
	/*

    public List<ClienteDto> listarClientes() {
        return clienteRepository.findAll()
                .stream()
                .map(this::mapearRespuesta)
                .toList();
    }

    public ClienteDto obtenerCliente(Long id) {
        Cliente cliente = clienteRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("Cliente no encontrado"));
        return mapearRespuesta(cliente);
    }

    public ClienteDto actualizarCliente(Long id, ClienteDto request) {
        Cliente cliente = clienteRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("Cliente no encontrado"));

        cliente.setNombre(request.getNombre());
        cliente.setGenero(request.getGenero());
        cliente.setEdad(request.getEdad());
        cliente.setDireccion(request.getDireccion());
        cliente.setTelefono(request.getTelefono());
        cliente.setEstado(request.getEstado());

        return mapearRespuesta(clienteRepository.save(cliente));
    }

    public void eliminarCliente(Long id) {
        if (!clienteRepository.existsById(id)) {
            throw new ResourceNotFoundException("Cliente no encontrado");
        }
        clienteRepository.deleteById(id);
    }

    */
	
	private CuentaDto mapearRespuesta(Cuenta cuenta) {
		CuentaDto c = CuentaDto.builder()
        		.cuentaid(cuenta.getCuentaid())
        		.numerocuenta(cuenta.getNumerocuenta())
        		.tipocuenta(cuenta.getTipocuenta())
        		.saldoinicial(cuenta.getSaldoinicial())
        		.estado(cuenta.getEstado())
        		.clienteid(cuenta.getCliente().getClienteid())
        		.build();
        return c;    
    }

}
